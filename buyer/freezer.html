<!-- ============================================================
AO-05/15 ‚Äî BUYER Shell (egen HTML) | FIL-ID: buyer/freezer.html
Projekt: Fryslager (UI-only / localStorage-first)

Syfte:
- Ink√∂pare ska ha en egen sida (ingen admin-UI).
- Visar endast BUYER-rutor (4 st) via router-menyn:
  Ny Leverant√∂r / Ny produkt / L√§gga in produkter / S√∂k Leverant√∂r

POLICY (L√ÖST):
- UI-only ‚Ä¢ inga nya storage-keys/datamodell
- XSS-safe (render via freezer-render / vyer)
- Fail-closed: om registry/router saknas -> visa minimal fallback

KRAV:
- ModalShell laddas som vanlig <script> s√• window.FreezerModal finns.
- ESM-moduler laddas som type="module" (view-interface/registry/vyer).
- P0: buyer-controller m√•ste INTE k√∂ra f√∂re registry -> anv√§nd defer.

P0-FIX (denna patch):
- BUYER-sidan m√•ste initiera FreezerStore (role=BUYER) efter att 03-store.js laddats,
  annars hydreras inte items/history fr√•n localStorage och state blir tom efter reload.
============================================================ -->
<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Freezer ‚Äì Ink√∂pare</title>

  <style>
    :root { color-scheme: light; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    header { border-bottom:1px solid #e6e6e6; background:#fff; }
    .wrap { max-width: 1100px; margin: 0 auto; padding: 12px 14px; }
    .row { display:flex; gap:12px; align-items:center; flex-wrap:wrap; }
    .brand { font-weight:700; }
    nav a { text-decoration:none; color:inherit; opacity:.8; }
    nav a:hover { opacity:1; }
    .spacer { flex: 1; }
    .pill { display:inline-flex; gap:8px; align-items:center; padding:6px 10px; border-radius:999px; border:1px solid #e6e6e6; background:#fafafa; font-size: 13px; }
    .pill b { font-weight:600; }
    .muted { opacity:.75; }
    .panel { border:1px solid #e6e6e6; border-radius: 12px; padding: 12px; background:#fff; }
    main { background:#f6f7f8; min-height: calc(100vh - 64px); }
    .tabs { display:flex; gap:8px; flex-wrap:wrap; }
    .tabBtn { border:1px solid #e6e6e6; background:#fff; border-radius:999px; padding:8px 12px; cursor:pointer; font-size: 14px; }
    .tabBtn[aria-selected="true"] { font-weight:700; }
    .danger { border-color:#f2b8b5; background:#fff5f5; }
    .ok { border-color:#cfe9cf; background:#f4fff4; }
    .btn { border:1px solid #e6e6e6; background:#fff; border-radius: 10px; padding:8px 10px; cursor:pointer; }
    .btn[disabled] { opacity:.55; cursor:not-allowed; }
    footer { padding: 16px 0; }

    .hr { height:1px; background:#eee; margin:10px 0; }
    .fallbackBox { padding:12px; border-radius:12px; border:1px dashed #ddd; background:#fff; }
  </style>
</head>

<body>
  <header>
    <div class="wrap">
      <div class="row">
        <div class="brand">üßä Freezer</div>

        <nav class="row" aria-label="Buyer navigation">
          <a href="../admin/index.html" class="muted">Admin Hem</a>
          <span class="muted">/</span>
          <a href="./freezer.html"><b>Ink√∂pare</b></a>
        </nav>

        <div class="spacer"></div>

        <div id="frzStatusPill" class="pill" role="status" aria-live="polite">
          <span class="muted">Status:</span>
          <b id="frzStatusText">Laddar‚Ä¶</b>
        </div>

        <div class="pill" title="Roll √§r l√•st p√• denna sida">
          <span class="muted">Roll:</span>
          <b>INK√ñPARE</b>
        </div>

        <button id="frzResetDemoBtn" class="btn" type="button" title="√Öterst√§ll demo-data (endast om ej read-only)">
          √Öterst√§ll demo
        </button>
      </div>
    </div>
  </header>

  <main>
    <div class="wrap">
      <!-- Fail-closed -->
      <section id="frzLockPanel" class="panel danger" hidden>
        <div class="row">
          <div>
            <b>Import stoppad / L√•st l√§ge</b>
            <div class="muted" id="frzLockReason">Orsak: ok√§nd</div>
          </div>
        </div>
      </section>

      <!-- Debug (visas bara vid avvikelse enligt freezer-render.js) -->
      <section id="frzDebugPanel" class="panel" hidden>
        <div class="row">
          <b>Debug</b>
          <div class="spacer"></div>
          <div class="muted" id="frzDebugText">‚Äî</div>
        </div>
      </section>

      <!-- BUYER ROUTER YTA -->
      <section class="panel">
        <div class="row">
          <div>
            <h1 style="margin:0; font-size:22px;">Ink√∂pare</h1>
            <div class="muted" style="margin-top:4px;">
              V√§lj vad du vill g√∂ra: skapa leverant√∂r, skapa produkt, l√§gga in produkter eller s√∂ka leverant√∂r.
            </div>
          </div>

          <div class="spacer"></div>

          <div class="pill" title="Visar om sidan √§r read-only">
            <span class="muted">L√§ge:</span>
            <b id="frzModeText">‚Äî</b>
          </div>
        </div>

        <div class="hr"></div>

        <!-- Router-meny (4 rutor f√∂r BUYER) -->
        <div id="freezerViewMenu" class="tabs" aria-label="Router-meny">
          <!-- fylls av freezer-buyer.js -->
        </div>

        <!-- Router-root -->
        <div id="freezerViewRoot" style="margin-top:10px;">
          <div id="frzBuyerFallback" class="fallbackBox muted">
            Laddar vyer‚Ä¶
          </div>
        </div>
      </section>

      <footer class="muted">
        AO-05/15 ‚Ä¢ BUYER shell ‚Ä¢ UI-only ‚Ä¢ localStorage-first ‚Ä¢ fail-closed
      </footer>
    </div>
  </main>

  <!-- ==========================================================
  Script order (KRITISK):
  Core ‚Üí Contract ‚Üí Store ‚Üí (INIT BUYER ROLE) ‚Üí Render/Dash ‚Üí ModalShell ‚Üí ESM views/registry ‚Üí buyer controller (defer)
  =========================================================== -->

  <!-- Core -->
  <script src="../UI/pages/freezer/02-core.js"></script>
  <script src="../UI/pages/freezer/04-contract.js"></script>

  <!-- Store (M√ÖSTE skapa window.FreezerStore) -->
  <script src="../UI/pages/freezer/03-store.js"></script>

  <!-- P0: INIT STORE (BUYER) ‚Äî beh√∂vs f√∂r hydrate fr√•n localStorage vid reload -->
  <script>
    (function () {
      "use strict";
      try {
        var S = window.FreezerStore;
        if (S && typeof S.init === "function") {
          // Fail-soft: initierar store med r√§tt roll s√• items/history hydreras.
          // Inga nya storage-keys/datamodell.
          window.__FRZ_BUYER_INIT__ = S.init({ role: "BUYER" });
        } else {
          // Fail-soft: buyer-controller kommer √§nd√• visa l√•s/fallback om store saknas.
          try { console.warn("FRZ: FreezerStore saknas eller init() saknas."); } catch {}
        }
      } catch (e) {
        try { console.warn("FRZ: FreezerStore.init error", e); } catch {}
      }
    })();
  </script>

  <!-- Render + dash (status/mode/lock/debug) -->
  <script src="../UI/freezer-render.js"></script>
  <script src="../UI/freezer-dashboard.js"></script>

  <!-- Modal shell (window.FreezerModal) -->
  <script src="../UI/pages/freezer/05-modal-shell.js"></script>

  <!-- ESM views + registry -->
  <script type="module" src="../UI/pages/freezer/00-view-interface.js"></script>
  <script type="module" src="../UI/pages/freezer/01-view-registry.js"></script>

  <!-- Buyer controller (P0: defer s√• registry hinner s√§ttas) -->
  <script defer src="../UI/pages/freezer/buyer/freezer-buyer.js"></script>
</body>
</html>
